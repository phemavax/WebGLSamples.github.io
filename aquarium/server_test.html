<html>
<body>
<script type="text/javascript" src="../tdl/base.js"></script>
<script>
tdl.require('tdl.io');
tdl.require('tdl.log');

var count = 0;
window.onload = init;

function DumpObj(obj, opt_prefix) {
  opt_prefix = opt_prefix || "";
  if (typeof obj == 'object') {
    if (obj.length !== undefined) {
      for (var ii = 0; ii < obj.length; ++ii) {
        DumpObj(obj[ii], opt_prefix + "[" + ii + "]");
      }
    } else {
      for (var name in obj) {
        DumpObj(obj[name], opt_prefix + "." + name);
      }
    }
  } else {
    tdl.log(opt_prefix, ": ", obj);
  }
}

function GetData() {
  tdl.io.loadJSON(
      "http://localhost:8080?id=123&cmd=get",
      function(obj, exception) {
        count++;
        tdl.log("--[", count, "]-------------");
        if (exception) {
          tdl.log("EXCEPTION: ", exception);
        } else {
          DumpObj(obj);
        }
        setTimeout(GetData, 3000);
      });
}

function PutData() {
  var a = { foobar: { speed: count }};
  tdl.io.sendJSON(
    "http://localhost:8080?cmd=put",
    a,
    function (obj, exception) {
        count++;
        tdl.log("--[", count, "]-------------");
        if (exception) {
          tdl.log("EXCEPTION: ", exception);
        } else {
          DumpObj(obj);
        }
        setTimeout(PutData, 3000);
    });
}

function init() {
  tdl.log("--start--");
  // GetData();
  PutData();
}
</script>
</body>
</html>
